spring:
  application:
    name: aitradex-service
app:
  uploads:
    directory: ${APP_UPLOADS_DIRECTORY:./data/uploads}
    max-size-mb: ${APP_UPLOADS_MAX_SIZE_MB:25}
    max-validation-errors: ${APP_UPLOADS_MAX_VALIDATION_ERRORS:50}
  market-data:
    default-source: ${APP_MARKET_DATA_DEFAULT_SOURCE:alphavantage}
    cache-ttl: ${APP_MARKET_DATA_CACHE_TTL:30s}
    cache-evict-interval-ms: ${APP_MARKET_DATA_CACHE_EVICT_MS:300000}
    stream-poll-interval: ${APP_MARKET_DATA_STREAM_POLL_INTERVAL:10s}
    stream-max-duration: ${APP_MARKET_DATA_STREAM_MAX_DURATION:5m}
    providers:
      alphavantage:
        enabled: true
        priority: 1
      yahoo:
        enabled: false  # Disabled: unreliable/may fail
        priority: 2
      stooq:
        enabled: false  # Disabled: unreliable/may fail
        priority: 3
      quote-snapshots:
        enabled: true
        priority: 4
  alpha-vantage:
    api-key: ${ALPHA_VANTAGE_API_KEY:B8IQ3ONTC1RTKRH7}
    base-url: ${ALPHA_VANTAGE_BASE_URL:https://www.alphavantage.co}
    enabled: ${ALPHA_VANTAGE_ENABLED:true}
  etrade:
    consumer-key: ${ETRADE_CONSUMER_KEY:a83b0321f09e97fc8f4315ad5fbcd489}
    consumer-secret: ${ETRADE_CONSUMER_SECRET:c4d304698d156d4c3681c73de0c4e400060cac46ee1504259b324695daa77dd4}
    callback-url: ${ETRADE_CALLBACK_URL:http://localhost:4200/etrade-review-trade/callback}
    environment: ${ETRADE_ENVIRONMENT:SANDBOX}
    base-url: ${ETRADE_BASE_URL:https://apisb.etrade.com}
    authorize-url: ${ETRADE_AUTHORIZE_URL:https://us.etrade.com/e/t/etws/authorize}
    enabled: ${ETRADE_ENABLED:true}
    encryption-key: ${ETRADE_ENCRYPTION_KEY:default-encryption-key-change-in-production-min-32-chars}
  stop-loss:
    poll-interval-ms: ${APP_STOP_LOSS_POLL_MS:60000}
    source: ${APP_STOP_LOSS_SOURCE:quote-snapshots}
  snapshots:
    poll-interval-ms: ${APP_SNAPSHOT_POLL_MS:300000}
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/aitradexdb}
    driver-class-name: org.postgresql.Driver
    username: ${SPRING_DATASOURCE_USERNAME:aitradex_user}
    password: ${SPRING_DATASOURCE_PASSWORD:aitradex_pass}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: aitradexHikariPool
  jpa:
    hibernate:
      ddl-auto: validate  # Use Liquibase for schema management
    open-in-view: false
    show-sql: ${SPRING_JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: true
        generate_statistics: false
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.yaml
    drop-first: false
    contexts: ${LIQUIBASE_CONTEXTS:}

server:
  port: 8080

management:
  endpoints:
    web:
      exposure:
        include: health, info
  endpoint:
    health:
      show-details: when_authorized

springdoc:
  api-docs:
    path: /api/docs
  swagger-ui:
    path: /api/swagger-ui.html

logging:
  level:
    root: INFO
    com.myqyl.aitradex: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.liquibase: INFO
  file:
    name: ${LOG_FILE:logs/aitradex-service.log}

---
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    url: jdbc:postgresql://localhost:5432/aitradexdb
    username: aitradex_user
    password: aitradex_pass
    hikari:
      pool-name: aitradexHikariPool-DEV
  jpa:
    show-sql: true
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.yaml
    drop-first: false
    contexts: dev,schema,data

logging:
  level:
    root: INFO
    com.myqyl.aitradex: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.liquibase: INFO
  file:
    name: logs/aitradex-service-dev.log

---
spring:
  config:
    activate:
      on-profile: test
  datasource:
    url: jdbc:postgresql://localhost:5432/aitradexdb_test
    username: aitradex_user
    password: aitradex_pass
    hikari:
      pool-name: aitradexHikariPool-TEST
  jpa:
    show-sql: false
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.yaml
    drop-first: false
    contexts: test

logging:
  level:
    root: WARN
    com.myqyl.aitradex: INFO

---
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/aitradexdb}
    username: ${SPRING_DATASOURCE_USERNAME:aitradex_user}
    password: ${SPRING_DATASOURCE_PASSWORD:aitradex_pass}
    hikari:
      pool-name: aitradexHikariPool-PROD
  jpa:
    show-sql: false
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-master.yaml
    drop-first: false
    contexts: prod

server:
  port: ${PORT:8080}

management:
  endpoints:
    web:
      exposure:
        include: health, info

logging:
  level:
    root: INFO
    com.myqyl.aitradex: INFO
  file:
    name: ${LOG_FILE:logs/aitradex-service-prod.log}
